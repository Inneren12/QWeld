name: Content Validation (full)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 4 * * *'

jobs:
  content-full:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install content tooling dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y jq
          npm i -D -w . ajv ajv-formats --no-save --no-package-lock

      - name: Validate blueprint
        run: bash scripts/validate-blueprint.sh

      - name: Validate questions (full)
        run: bash scripts/validate-questions.sh

      - name: Validate explanations
        run: bash scripts/validate-explanations.sh

      - name: Check question quotas (full)
        run: bash scripts/check-quotas.sh --profile content/exam_profiles/welder_exam_2024.json --locales en,ru --mode min --min-multiple 1 --allow-extra

      - name: Build question banks
        run: bash scripts/build-questions-dist.sh

      - name: Upload validation logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: content-validation-logs
          path: logs

      - name: Upload question bank dist
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: questions-dist
          path: dist/questions

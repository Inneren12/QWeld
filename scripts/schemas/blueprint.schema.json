{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Welder Blueprint (strict quotas)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "id",
    "trade",
    "exam",
    "blueprintVersion",
    "policyVersion",
    "questionCount",
    "validFrom",
    "sources",
    "blocks"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^welder_ip_[a-z]{2}_[0-9]{6}$"
    },
    "trade": {
      "type": "string",
      "const": "Welder"
    },
    "exam": {
      "type": "string",
      "const": "Interprovincial Red Seal"
    },
    "blueprintVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "policyVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$"
    },
    "questionCount": {
      "type": "integer",
      "minimum": 1
    },
    "validFrom": {
      "type": "string",
      "format": "date"
    },
    "sources": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "type",
          "name",
          "notes"
        ],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "primary",
              "historical",
              "reference"
            ]
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "notes": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    "blocks": {
      "type": "array",
      "minItems": 4,
      "maxItems": 4,
      "items": [
        {
          "$ref": "#/$defs/blockA"
        },
        {
          "$ref": "#/$defs/blockB"
        },
        {
          "$ref": "#/$defs/blockC"
        },
        {
          "$ref": "#/$defs/blockD"
        }
      ],
      "additionalItems": false
    }
  },
  "$defs": {
    "task": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "title",
        "quota"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[A-D]-\\d{1,2}$"
        },
        "title": {
          "type": "string",
          "minLength": 1
        },
        "quota": {
          "type": "integer",
          "minimum": 1
        }
      }
    },
    "blockBase": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "title",
        "tasks"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[A-D]$"
        },
        "title": {
          "type": "string",
          "minLength": 1
        },
        "tasks": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/task"
          }
        }
      }
    },
    "blockA": {
      "allOf": [
        {
          "$ref": "#/$defs/blockBase"
        },
        {
          "properties": {
            "id": {
              "type": "string",
              "const": "A"
            },
            "tasks": {
              "minItems": 4,
              "maxItems": 4
            }
          }
        }
      ]
    },
    "blockB": {
      "allOf": [
        {
          "$ref": "#/$defs/blockBase"
        },
        {
          "properties": {
            "id": {
              "type": "string",
              "const": "B"
            },
            "tasks": {
              "minItems": 4,
              "maxItems": 4
            }
          }
        }
      ]
    },
    "blockC": {
      "allOf": [
        {
          "$ref": "#/$defs/blockBase"
        },
        {
          "properties": {
            "id": {
              "type": "string",
              "const": "C"
            },
            "tasks": {
              "minItems": 4,
              "maxItems": 4
            }
          }
        }
      ]
    },
    "blockD": {
      "allOf": [
        {
          "$ref": "#/$defs/blockBase"
        },
        {
          "properties": {
            "id": {
              "type": "string",
              "const": "D"
            },
            "tasks": {
              "minItems": 3,
              "maxItems": 3
            }
          }
        }
      ]
    }
  }
}

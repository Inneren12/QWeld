package com.qweld.app.data.reports

import kotlinx.serialization.SerialName
import kotlinx.serialization.Serializable

@Serializable
internal data class QueuedQuestionReportPayload(
  val questionId: String,
  val taskId: String,
  val blockId: String,
  val blueprintId: String,
  val locale: String,
  val mode: String,
  val reasonCode: String,
  val reasonDetail: String? = null,
  val userComment: String? = null,
  val questionIndex: Int? = null,
  val totalQuestions: Int? = null,
  val selectedChoiceIds: List<Int>? = null,
  val correctChoiceIds: List<Int>? = null,
  val blueprintTaskQuota: Int? = null,
  val contentIndexSha: String? = null,
  val blueprintVersion: String? = null,
  val contentVersion: String? = null,
  val appVersionName: String? = null,
  val appVersionCode: Int? = null,
  val buildType: String? = null,
  val platform: String? = null,
  @SerialName("osVersion")
  val legacyOsVersion: String? = null,
  val androidVersion: String? = null,
  val deviceModel: String? = null,
  val sessionId: String? = null,
  val attemptId: String? = null,
  val seed: Long? = null,
  val attemptKind: String? = null,
  val status: String = "OPEN",
  val review: Map<String, String?>? = null,
) {
  fun toQuestionReport(): QuestionReport {
    return QuestionReport(
      questionId = questionId,
      taskId = taskId,
      blockId = blockId,
      blueprintId = blueprintId,
      locale = locale,
      mode = mode,
      reasonCode = reasonCode,
      reasonDetail = reasonDetail,
      userComment = userComment,
      questionIndex = questionIndex,
      totalQuestions = totalQuestions,
      selectedChoiceIds = selectedChoiceIds,
      correctChoiceIds = correctChoiceIds,
      blueprintTaskQuota = blueprintTaskQuota,
      contentIndexSha = contentIndexSha,
      blueprintVersion = blueprintVersion,
      contentVersion = contentVersion,
      appVersionName = appVersionName,
      appVersionCode = appVersionCode,
      buildType = buildType,
      platform = platform,
      androidVersion = androidVersion ?: legacyOsVersion,
      deviceModel = deviceModel,
      sessionId = sessionId,
      attemptId = attemptId,
      seed = seed,
      attemptKind = attemptKind,
      status = status,
      createdAt = null,
      review = review?.mapValues { it.value },
    )
  }

  companion object {
    fun fromReport(report: QuestionReport): QueuedQuestionReportPayload {
      return QueuedQuestionReportPayload(
        questionId = report.questionId,
        taskId = report.taskId,
        blockId = report.blockId,
        blueprintId = report.blueprintId,
        locale = report.locale,
        mode = report.mode,
        reasonCode = report.reasonCode,
        reasonDetail = report.reasonDetail,
        userComment = report.userComment,
        questionIndex = report.questionIndex,
        totalQuestions = report.totalQuestions,
        selectedChoiceIds = report.selectedChoiceIds,
        correctChoiceIds = report.correctChoiceIds,
        blueprintTaskQuota = report.blueprintTaskQuota,
        contentIndexSha = report.contentIndexSha,
        blueprintVersion = report.blueprintVersion,
        contentVersion = report.contentVersion,
        appVersionName = report.appVersionName,
        appVersionCode = report.appVersionCode,
        buildType = report.buildType,
        platform = report.platform,
        androidVersion = report.androidVersion,
        deviceModel = report.deviceModel,
        sessionId = report.sessionId,
        attemptId = report.attemptId,
        seed = report.seed,
        attemptKind = report.attemptKind,
        status = report.status,
        review = report.review?.mapValues { it.value?.toString() },
      )
    }
  }
}
